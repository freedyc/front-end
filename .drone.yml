---
kind: pipeline
type: docker
name: web

steps:
- name: install
  image: node
  commands:
  - yarn

- name: test
  image: node
  commands:
  - yarn playwright

- name: build
  image: node
  commands:
  - npm run build

- name: rsync
  image: drillster/drone-rsync
  environment:
    RSYNC_KEY:
      from_secret: rsync_key
  settings:
    user: root
    hosts:
      - bugchao.com
    source: ./dist/*
    target: /usr/share/front-end
    secrets: [ rsync_key ]

- name: notify
  image: lddsb/drone-dingtalk-message
  settings:
    token: da1643f55595bab854144f529a7df48a9f6cfbf509a2a7d285c76b7bb5543c13
    type: markdown
    secret: SEC9566f2ed09b21bcc4e373fc457bb38289b9da7347afdf66279f816d2d8c9f99a
