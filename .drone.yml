---
kind: pipeline
type: docker
name: web

steps:
- name: install
  image: node:14
  commands:
  - npm i --registry=https://registry.npm.taobao.org

- name: test
  image: node:14
  commands:
  - npm run playwright

- name: build
  image: node:14
  commands:
  - npm run build

- name: rsync
  image: drillster/drone-rsync
  environment:
    RSYNC_KEY:
      from_secret: rsync_key
  settings:
    user: root
    hosts:
      - bugchao.com
    source: ./dist
    target: /usr/share/front-end
    secrets: [ rsync_key ]

